<div class="categories-page" [dir]="i18n.currentLang === 'ar' ? 'rtl' : 'ltr'">
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-bg"></div>
        <div class="hero-content">
            <h1>
                <i class="fa-solid fa-layer-group"></i>
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª' : 'Categories Management' }}
            </h1>
            <p>{{ i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù ÙØ¦Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„ÙØ±Ø¹ÙŠØ©' : 'Add, edit and delete main and sub categories' }}</p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Actions Bar -->
        <div class="actions-bar">
            <!-- Search -->
            <div class="search-box">
                <i class="fa-solid fa-search"></i>
                <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
                    [placeholder]="i18n.currentLang === 'ar' ? 'Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙØ¦Ø©...' : 'Search categories...'" />
                <button *ngIf="searchTerm" class="clear-btn" (click)="searchTerm = ''; onSearchChange()">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>

            <!-- ğŸ†• Type Filter (All/Parents/Children) -->
            <div class="filter-buttons type-filters">
                <button class="filter-btn" [class.active]="filterType === 'all'" (click)="setTypeFilter('all')">
                    <i class="fa-solid fa-list"></i>
                    {{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙƒÙ„' : 'All' }}
                </button>
                <button class="filter-btn parent-filter" [class.active]="filterType === 'parents'"
                    (click)="setTypeFilter('parents')">
                    <i class="fa-solid fa-folder"></i>
                    {{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' : 'Main' }}
                </button>
                <button class="filter-btn child-filter" [class.active]="filterType === 'children'"
                    (click)="setTypeFilter('children')">
                    <i class="fa-solid fa-folder-tree"></i>
                    {{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙØ±Ø¹ÙŠØ©' : 'Sub' }}
                </button>
            </div>

            <!-- Status Filter -->
            <div class="filter-buttons">
                <button class="filter-btn active-filter" [class.active]="filterStatus === true"
                    (click)="setStatusFilter(filterStatus === true ? null : true)">
                    {{ i18n.currentLang === 'ar' ? 'Ù†Ø´Ø·' : 'Active' }}
                </button>
                <button class="filter-btn inactive-filter" [class.active]="filterStatus === false"
                    (click)="setStatusFilter(filterStatus === false ? null : false)">
                    {{ i18n.currentLang === 'ar' ? 'ØºÙŠØ± Ù†Ø´Ø·' : 'Inactive' }}
                </button>
            </div>

            <!-- Add Buttons -->
            <div class="add-buttons">
                <button class="add-btn primary" (click)="openAddModal(null)">
                    <i class="fa-solid fa-plus"></i>
                    {{ i18n.currentLang === 'ar' ? 'ÙØ¦Ø© Ø±Ø¦ÙŠØ³ÙŠØ©' : 'Main Category' }}
                </button>
                <button class="add-btn secondary" (click)="openAddModal(null)" *ngIf="parentCategories.length > 0">
                    <i class="fa-solid fa-folder-plus"></i>
                    {{ i18n.currentLang === 'ar' ? 'ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©' : 'Subcategory' }}
                </button>
            </div>
        </div>

        <!-- ğŸ†• Parent Filter Dropdown (when viewing children) -->
        <div class="parent-filter-bar" *ngIf="filterType === 'children' && parentCategories.length > 0">
            <label>{{ i18n.currentLang === 'ar' ? 'ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:' : 'Filter by parent:' }}</label>
            <select [(ngModel)]="filterParentId" (ngModelChange)="filterByParent($event)">
                <option [ngValue]="null">{{ i18n.currentLang === 'ar' ? 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©' : 'All subcategories' }}
                </option>
                <option *ngFor="let parent of parentCategories" [ngValue]="parent.id">
                    {{ getName(parent) }}
                </option>
            </select>
        </div>

        <!-- Loading -->
        <div *ngIf="isLoading" class="loading">
            <div class="spinner"></div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && categories.length === 0" class="empty-state">
            <div class="empty-icon">
                <i class="fa-solid fa-folder-open"></i>
            </div>
            <h3>{{ i18n.currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª' : 'No categories found' }}</h3>
            <p>{{ i18n.currentLang === 'ar' ? 'Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ø¬Ø¯ÙŠØ¯Ø©' : 'Start by adding a new category' }}</p>
            <button class="add-btn" (click)="openAddModal(null)">
                <i class="fa-solid fa-plus"></i>
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©' : 'Add Category' }}
            </button>
        </div>

        <!-- Categories Table -->
        <div *ngIf="!isLoading && categories.length > 0" class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th class="expand-col"></th>
                        <th>#</th>
                        <th>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ØµÙˆØ±Ø©' : 'Image' }}</th>
                        <th>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ' : 'Arabic Name' }}</th>
                        <th>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ' : 'English Name' }}</th>
                        <th>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ù†ÙˆØ¹' : 'Type' }}</th>
                        <th>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' : 'Parent' }}</th>
                        <th>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' : 'Products' }}</th>
                        <th>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø­Ø§Ù„Ø©' : 'Status' }}</th>
                        <th>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª' : 'Actions' }}</th>
                    </tr>
                </thead>
                <tbody>
                    <ng-container *ngFor="let category of categories; let i = index">
                        <!-- Main Row -->
                        <tr [class.parent-row]="!isSubcategory(category)" [class.child-row]="isSubcategory(category)"
                            [class.has-children]="hasChildren(category)">

                            <!-- Expand Button -->
                            <td class="expand-col">
                                <button *ngIf="hasChildren(category)" class="expand-btn"
                                    (click)="toggleRowExpand(category.id)"
                                    [class.expanded]="isRowExpanded(category.id)">
                                    <i class="fa-solid"
                                        [ngClass]="isRowExpanded(category.id) ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
                                </button>
                            </td>

                            <td class="row-number">{{ getRowNumber(i) }}</td>

                            <td class="image-cell">
                                <div class="category-image">
                                    <img [src]="getImageUrl(category.image)" [alt]="category.nameAr"
                                        (error)="$any($event.target).src = 'https://placehold.co/150x150/e2e8f0/94a3b8?text=No+Image'" />
                                </div>
                            </td>

                            <td class="name-cell">
                                <span [class.subcategory-indent]="isSubcategory(category)">
                                    <i *ngIf="isSubcategory(category)"
                                        class="fa-solid fa-turn-up fa-rotate-90 indent-icon"></i>
                                    {{ category.nameAr }}
                                </span>
                            </td>

                            <td class="name-cell name-en">{{ category.nameEn }}</td>

                            <!-- ğŸ†• Type Badge -->
                            <td>
                                <span class="type-badge" [class.main]="!isSubcategory(category)"
                                    [class.sub]="isSubcategory(category)">
                                    <i class="fa-solid"
                                        [ngClass]="isSubcategory(category) ? 'fa-folder-tree' : 'fa-folder'"></i>
                                    {{ isSubcategory(category)
                                    ? (i18n.currentLang === 'ar' ? 'ÙØ±Ø¹ÙŠØ©' : 'Sub')
                                    : (i18n.currentLang === 'ar' ? 'Ø±Ø¦ÙŠØ³ÙŠØ©' : 'Main')
                                    }}
                                </span>
                            </td>

                            <!-- ğŸ†• Parent Name -->
                            <td class="parent-cell">
                                <span *ngIf="isSubcategory(category)" class="parent-name">
                                    {{ getParentName(category) }}
                                </span>
                                <span *ngIf="!isSubcategory(category) && hasChildren(category)" class="children-count">
                                    <i class="fa-solid fa-sitemap"></i>
                                    {{ getChildrenCount(category) }} {{ i18n.currentLang === 'ar' ? 'ÙØ±Ø¹ÙŠØ©' : 'sub' }}
                                </span>
                                <span *ngIf="!isSubcategory(category) && !hasChildren(category)"
                                    class="no-children">-</span>
                            </td>

                            <td>
                                <span class="product-count">
                                    <i class="fa-solid fa-box"></i>
                                    {{ category.productCount }}
                                </span>
                            </td>

                            <td>
                                <button class="status-toggle" [class.active]="category.isActive"
                                    (click)="toggleStatus(category)"
                                    [title]="i18n.currentLang === 'ar' ? 'ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©' : 'Toggle status'">
                                    <span class="toggle-track">
                                        <span class="toggle-thumb"></span>
                                    </span>
                                    <span class="status-text">
                                        {{ category.isActive
                                        ? (i18n.currentLang === 'ar' ? 'Ù†Ø´Ø·' : 'Active')
                                        : (i18n.currentLang === 'ar' ? 'ØºÙŠØ± Ù†Ø´Ø·' : 'Inactive')
                                        }}
                                    </span>
                                </button>
                            </td>

                            <td>
                                <div class="actions">
                                    <!-- ğŸ†• Add Subcategory Button (only for parent categories) -->
                                    <button *ngIf="!isSubcategory(category)" class="action-btn add-sub"
                                        (click)="openAddModal(category.id)"
                                        [title]="i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©' : 'Add subcategory'">
                                        <i class="fa-solid fa-folder-plus"></i>
                                    </button>
                                    <button class="action-btn edit" (click)="openEditModal(category)"
                                        [title]="i18n.currentLang === 'ar' ? 'ØªØ¹Ø¯ÙŠÙ„' : 'Edit'">
                                        <i class="fa-solid fa-pen"></i>
                                    </button>
                                    <button class="action-btn delete" (click)="openDeleteModal(category)"
                                        [title]="i18n.currentLang === 'ar' ? 'Ø­Ø°Ù' : 'Delete'">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <!-- ğŸ†• Expanded Children Rows -->
                        <ng-container *ngIf="isRowExpanded(category.id) && category.children">
                            <tr *ngFor="let child of category.children" class="child-row expanded-child">
                                <td class="expand-col"></td>
                                <td class="row-number">-</td>
                                <td class="image-cell">
                                    <div class="category-image small">
                                        <img [src]="getImageUrl(child.image)" [alt]="child.nameAr" />
                                    </div>
                                </td>
                                <td class="name-cell">
                                    <span class="subcategory-indent">
                                        <i class="fa-solid fa-turn-up fa-rotate-90 indent-icon"></i>
                                        {{ child.nameAr }}
                                    </span>
                                </td>
                                <td class="name-cell name-en">{{ child.nameEn }}</td>
                                <td>
                                    <span class="type-badge sub">
                                        <i class="fa-solid fa-folder-tree"></i>
                                        {{ i18n.currentLang === 'ar' ? 'ÙØ±Ø¹ÙŠØ©' : 'Sub' }}
                                    </span>
                                </td>
                                <td class="parent-cell">
                                    <span class="parent-name">{{ getName(category) }}</span>
                                </td>
                                <td>
                                    <span class="product-count">
                                        <i class="fa-solid fa-box"></i>
                                        {{ child.productCount }}
                                    </span>
                                </td>
                                <td>
                                    <button class="status-toggle" [class.active]="child.isActive"
                                        (click)="toggleStatus(child)">
                                        <span class="toggle-track">
                                            <span class="toggle-thumb"></span>
                                        </span>
                                    </button>
                                </td>
                                <td>
                                    <div class="actions">
                                        <button class="action-btn edit" (click)="openEditModal(child)">
                                            <i class="fa-solid fa-pen"></i>
                                        </button>
                                        <button class="action-btn delete" (click)="openDeleteModal(child)">
                                            <i class="fa-solid fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </ng-container>
                    </ng-container>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <!-- Pagination -->
        <div *ngIf="!isLoading && totalPages > 0" class="pagination">
            <!-- Previous Button -->
            <button class="page-btn prev" (click)="prevPage()" [disabled]="!hasPrev" [class.disabled]="!hasPrev">
                <i class="fa-solid fa-chevron-right"></i>
                <span class="btn-text">{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø³Ø§Ø¨Ù‚' : 'Previous' }}</span>
            </button>

            <!-- Page Numbers -->
            <div class="page-numbers">
                <button *ngIf="getPageNumbers()[0] > 1" class="page-num" (click)="goToPage(1)">1</button>
                <span *ngIf="getPageNumbers()[0] > 2" class="dots">...</span>

                <button *ngFor="let page of getPageNumbers()" class="page-num" [class.active]="page === currentPage"
                    (click)="goToPage(page)">
                    {{ page }}
                </button>

                <span *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages - 1" class="dots">...</span>
                <button *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages" class="page-num"
                    (click)="goToPage(totalPages)">
                    {{ totalPages }}
                </button>
            </div>

            <!-- Next Button -->
            <button class="page-btn next" (click)="nextPage()" [disabled]="!hasNext" [class.disabled]="!hasNext">
                <span class="btn-text">{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ØªØ§Ù„ÙŠ' : 'Next' }}</span>
                <i class="fa-solid fa-chevron-left"></i>
            </button>
        </div>

        <!-- Page Info -->
        <div *ngIf="!isLoading && categories.length > 0" class="page-info">
            {{ i18n.currentLang === 'ar' ? 'Ø¹Ø±Ø¶' : 'Showing' }}
            {{ (currentPage - 1) * pageSize + 1 }} -
            {{ currentPage * pageSize > totalCount ? totalCount : currentPage * pageSize }}
            {{ i18n.currentLang === 'ar' ? 'Ù…Ù†' : 'of' }} {{ totalCount }}
            {{ i18n.currentLang === 'ar' ? 'ÙØ¦Ø©' : 'categories' }}
        </div>
    </div>
</div>

<!-- Add/Edit Modal -->
<div class="modal-overlay" *ngIf="showAddModal || showEditModal" (click)="closeModals()">
    <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>
                <i class="fa-solid" [ngClass]="showAddModal ? 'fa-plus-circle' : 'fa-edit'"></i>
                {{ showAddModal
                ? (formData.parentId
                ? (i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©' : 'Add Subcategory')
                : (i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ø±Ø¦ÙŠØ³ÙŠØ©' : 'Add Main Category'))
                : (i18n.currentLang === 'ar' ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ¦Ø©' : 'Edit Category')
                }}
            </h2>
            <button class="close-btn" (click)="closeModals()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>

        <div class="modal-body">
            <!-- ğŸ†• Parent Category Dropdown -->
            <div class="form-group">
                <label>
                    <i class="fa-solid fa-sitemap"></i>
                    {{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' : 'Parent Category' }}
                </label>
                <select [(ngModel)]="formData.parentId" class="parent-select">
                    <option [ngValue]="null">
                        {{ i18n.currentLang === 'ar' ? '-- Ø¨Ø¯ÙˆÙ† (ÙØ¦Ø© Ø±Ø¦ÙŠØ³ÙŠØ©) --' : '-- None (Main Category) --' }}
                    </option>
                    <option *ngFor="let parent of getAvailableParents()" [ngValue]="parent.id">
                        {{ getName(parent) }}
                    </option>
                </select>
                <small class="hint">
                    {{ formData.parentId
                    ? (i18n.currentLang === 'ar' ? 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙƒÙØ¦Ø© ÙØ±Ø¹ÙŠØ©' : 'Will be added as subcategory')
                    : (i18n.currentLang === 'ar' ? 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙƒÙØ¦Ø© Ø±Ø¦ÙŠØ³ÙŠØ©' : 'Will be added as main category')
                    }}
                </small>
            </div>

            <!-- Arabic Name -->
            <div class="form-group">
                <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ' : 'Arabic Name' }} *</label>
                <input type="text" [(ngModel)]="formData.nameAr" [class.error]="formErrors.nameAr"
                    [placeholder]="i18n.currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ' : 'Enter category name in Arabic'"
                    dir="rtl" />
                <span *ngIf="formErrors.nameAr" class="error-msg">{{ formErrors.nameAr }}</span>
            </div>

            <!-- English Name -->
            <div class="form-group">
                <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ' : 'English Name' }} *</label>
                <input type="text" [(ngModel)]="formData.nameEn" [class.error]="formErrors.nameEn"
                    placeholder="Enter category name in English" dir="ltr" />
                <span *ngIf="formErrors.nameEn" class="error-msg">{{ formErrors.nameEn }}</span>
            </div>

            <!-- Image Upload -->
            <div class="form-group">
                <label>{{ i18n.currentLang === 'ar' ? 'ØµÙˆØ±Ø© Ø§Ù„ÙØ¦Ø©' : 'Category Image' }}</label>

                <div class="image-upload-area">
                    <!-- Preview -->
                    <div class="image-preview" *ngIf="imagePreview || formData.image">
                        <img [src]="imagePreview || getImageUrl(formData.image)" alt="Category Image" />
                        <button type="button" class="remove-image-btn" (click)="removeImage()">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>

                    <!-- Upload Button -->
                    <label class="upload-btn" *ngIf="!imagePreview && !formData.image">
                        <i class="fa-solid fa-cloud-upload-alt"></i>
                        <span>{{ i18n.currentLang === 'ar' ? 'Ø§Ø®ØªØ± ØµÙˆØ±Ø©' : 'Choose Image' }}</span>
                        <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden />
                    </label>

                    <!-- Change Button -->
                    <label class="change-image-btn" *ngIf="imagePreview || formData.image">
                        <i class="fa-solid fa-camera"></i>
                        {{ i18n.currentLang === 'ar' ? 'ØªØºÙŠÙŠØ±' : 'Change' }}
                        <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden />
                    </label>
                </div>

                <small class="hint">{{ i18n.currentLang === 'ar' ? 'JPG, PNG, GIF (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5MB)' : 'JPG, PNG, GIF (max
                    5MB)' }}</small>
            </div>

            <!-- Status Toggle (Edit Only) -->
            <div *ngIf="showEditModal" class="form-group status-group">
                <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø­Ø§Ù„Ø©' : 'Status' }}</label>
                <button type="button" class="status-toggle large" [class.active]="formData.isActive"
                    (click)="formData.isActive = !formData.isActive">
                    <span class="toggle-track">
                        <span class="toggle-thumb"></span>
                    </span>
                    <span class="status-text">
                        {{ formData.isActive
                        ? (i18n.currentLang === 'ar' ? 'Ù†Ø´Ø·' : 'Active')
                        : (i18n.currentLang === 'ar' ? 'ØºÙŠØ± Ù†Ø´Ø·' : 'Inactive')
                        }}
                    </span>
                </button>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn-cancel" (click)="closeModals()" [disabled]="isSubmitting || isUploading">
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
            </button>

            <button class="btn-submit" (click)="uploadAndSave()" [disabled]="isSubmitting || isUploading">
                <span *ngIf="isSubmitting || isUploading" class="btn-spinner"></span>
                <i *ngIf="!isSubmitting && !isUploading" class="fa-solid fa-check"></i>
                {{ showAddModal
                ? (i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ©' : 'Add')
                : (i18n.currentLang === 'ar' ? 'ØªØ­Ø¯ÙŠØ«' : 'Update')
                }}
            </button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeModals()">
    <div class="modal delete-modal" (click)="$event.stopPropagation()">
        <div class="delete-icon">
            <i class="fa-solid fa-trash"></i>
        </div>
        <h3>{{ i18n.currentLang === 'ar' ? 'Ø­Ø°Ù Ø§Ù„ÙØ¦Ø©' : 'Delete Category' }}</h3>
        <p>
            {{ i18n.currentLang === 'ar' ? 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙØ¦Ø©' : 'Are you sure you want to delete' }}
            <strong>"{{ selectedCategory?.nameAr }}"</strong>ØŸ
        </p>

        <!-- Warning: Has Children -->
        <p *ngIf="selectedCategory && hasChildren(selectedCategory)" class="warning-text">
            <i class="fa-solid fa-exclamation-triangle"></i>
            {{ i18n.currentLang === 'ar'
            ? 'ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© Ù„Ø¯ÙŠÙ‡Ø§ ' + getChildrenCount(selectedCategory!) + ' ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©'
            : 'Warning: This category has ' + getChildrenCount(selectedCategory!) + ' subcategories'
            }}
        </p>

        <!-- Warning: Has Products -->
        <p *ngIf="selectedCategory?.productCount && selectedCategory!.productCount > 0" class="warning-text">
            <i class="fa-solid fa-exclamation-triangle"></i>
            {{ i18n.currentLang === 'ar'
            ? 'ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ ' + selectedCategory!.productCount + ' Ù…Ù†ØªØ¬'
            : 'Warning: This category has ' + selectedCategory!.productCount + ' products'
            }}
        </p>

        <div class="modal-actions">
            <button class="btn-cancel" (click)="closeModals()" [disabled]="isSubmitting">
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
            </button>
            <button class="btn-delete" (click)="deleteCategory()" [disabled]="isSubmitting">
                <span *ngIf="isSubmitting" class="btn-spinner"></span>
                <i *ngIf="!isSubmitting" class="fa-solid fa-trash"></i>
                {{ i18n.currentLang === 'ar' ? 'Ø­Ø°Ù' : 'Delete' }}
            </button>
        </div>
    </div>
</div>

<!-- Toast -->
<div class="toast" [class.show]="toast.show" [class.success]="toast.type === 'success'"
    [class.error]="toast.type === 'error'">
    <i class="fa-solid" [ngClass]="toast.type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'"></i>
    <span>{{ toast.message }}</span>
</div>