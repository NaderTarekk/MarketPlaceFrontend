<div class="cart-page">
    <!-- Hero -->
    <section class="hero">
        <div class="hero-bg"></div>
        <div class="hero-content">
            <h1>
                <i class="fa-solid fa-cart-shopping"></i>
                {{ i18n.currentLang === 'ar' ? 'Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚' : 'Shopping Cart' }}
            </h1>
            <p>{{ i18n.currentLang === 'ar' ? 'Ø±Ø§Ø¬Ø¹ Ù…Ù†ØªØ¬Ø§ØªÙƒ Ù‚Ø¨Ù„ Ø§Ù„Ø´Ø±Ø§Ø¡' : 'Review your items before checkout' }}</p>
        </div>
    </section>

    <div class="main-container">
        <!-- Loading -->
        <div *ngIf="isLoading" class="loading">
            <div class="spinner"></div>
            <p>{{ i18n.currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : 'Loading...' }}</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && cartItems.length === 0" class="empty-state">
            <div class="empty-icon">
                <i class="fa-solid fa-cart-shopping"></i>
            </div>
            <h3>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©' : 'Your cart is empty' }}</h3>
            <p>{{ i18n.currentLang === 'ar' ? 'Ù„Ù… ØªØ¶Ù Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯' : 'You haven\'t added any products yet' }}
            </p>
            <button class="btn-shop" routerLink="/products">
                <i class="fa-solid fa-shopping-bag"></i>
                {{ i18n.currentLang === 'ar' ? 'ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' : 'Browse Products' }}
            </button>
        </div>

        <!-- Cart Content -->
        <div *ngIf="!isLoading && cartItems.length > 0" class="cart-content">
            <!-- Cart Items -->
            <div class="cart-items-section">
                <!-- Header -->
                <div class="section-header">
                    <h2>
                        <i class="fa-solid fa-box"></i>
                        {{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' : 'Products' }}
                        <span class="items-count">({{ cartItems.length }})</span>
                    </h2>
                    <button class="btn-clear" (click)="openClearDialog()">
                        <i class="fa-solid fa-trash"></i>
                        {{ i18n.currentLang === 'ar' ? 'ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©' : 'Clear Cart' }}
                    </button>
                </div>

                <!-- Items List -->
                <div class="cart-items">
                    <div *ngFor="let item of cartItems; trackBy: trackByItem" class="cart-item">
                        <!-- Product Image -->
                        <div class="item-image" (click)="goToProduct(item.productId)">
                            <img [src]="getImageUrl(item.productImage)" [alt]="getName(item)" />
                            <span *ngIf="getDiscountPercentage(item)" class="discount-badge">
                                -{{ getDiscountPercentage(item) }}%
                            </span>
                        </div>

                        <!-- Product Info -->
                        <div class="item-info">
                            <h3 class="item-name" (click)="goToProduct(item.productId)">{{ getName(item) }}</h3>

                            <div class="item-price">
                                <span class="current-price">{{ formatPrice(item.price) }}</span>
                                <span *ngIf="item.originalPrice && item.originalPrice > item.price"
                                    class="original-price">
                                    {{ formatPrice(item.originalPrice) }}
                                </span>
                            </div>

                            <div class="stock-status" [class.low]="item.stock <= 5">
                                <i class="fa-solid"
                                    [ngClass]="item.stock > 0 ? 'fa-check-circle' : 'fa-times-circle'"></i>
                                <span *ngIf="item.stock > 5">{{ i18n.currentLang === 'ar' ? 'Ù…ØªÙˆÙØ±' : 'In Stock'
                                    }}</span>
                                <span *ngIf="item.stock > 0 && item.stock <= 5">
                                    {{ i18n.currentLang === 'ar' ? 'Ù…ØªØ¨Ù‚ÙŠ ' + item.stock + ' ÙÙ‚Ø·' : 'Only ' + item.stock
                                    + ' left' }}
                                </span>
                                <span *ngIf="item.stock === 0">{{ i18n.currentLang === 'ar' ? 'ØºÙŠØ± Ù…ØªÙˆÙØ±' : 'Out of
                                    Stock' }}</span>
                            </div>
                        </div>

                        <!-- Quantity Controls -->
                        <div class="item-quantity">
                            <button class="qty-btn minus" (click)="updateQuantity(item, -1)"
                                [disabled]="item.quantity <= 1">
                                <i class="fa-solid fa-minus"></i>
                            </button>
                            <input type="number" [value]="item.quantity" (change)="setQuantity(item, $event)" min="1"
                                [max]="item.stock" />
                            <button class="qty-btn plus" (click)="updateQuantity(item, 1)"
                                [disabled]="item.quantity >= item.stock">
                                <i class="fa-solid fa-plus"></i>
                            </button>
                        </div>

                        <!-- Item Total -->
                        <div class="item-total">
                            <span class="total-label">{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ' : 'Total' }}</span>
                            <span class="total-value">{{ formatPrice(item.price * item.quantity) }}</span>
                        </div>

                        <!-- Remove Button -->
                        <button class="btn-remove" (click)="openDeleteDialog(item)">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
                <h2>{{ i18n.currentLang === 'ar' ? 'Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨' : 'Order Summary' }}</h2>

                <!-- Promo Code -->
                <div class="promo-section">
                    <div *ngIf="!promoApplied" class="promo-input">
                        <input type="text" [(ngModel)]="promoCode"
                            [placeholder]="i18n.currentLang === 'ar' ? 'ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…' : 'Promo Code'" />
                        <button (click)="applyPromoCode()">
                            {{ i18n.currentLang === 'ar' ? 'ØªØ·Ø¨ÙŠÙ‚' : 'Apply' }}
                        </button>
                    </div>
                    <div *ngIf="promoApplied" class="promo-applied">
                        <span>
                            <i class="fa-solid fa-tag"></i>
                            {{ promoCode }} (-{{ promoDiscount }}%)
                        </span>
                        <button (click)="removePromoCode()">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Summary Details -->
                <div class="summary-details">
                    <div class="summary-row">
                        <span>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ' : 'Subtotal' }}</span>
                        <span>{{ formatPrice(subtotal) }}</span>
                    </div>

                    <div *ngIf="discount > 0" class="summary-row discount">
                        <span>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø®ØµÙ…' : 'Discount' }}</span>
                        <span>-{{ formatPrice(discount) }}</span>
                    </div>

                    <div *ngIf="promoApplied" class="summary-row promo">
                        <span>{{ i18n.currentLang === 'ar' ? 'ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…' : 'Promo Code' }}</span>
                        <span>-{{ formatPrice(subtotal * promoDiscount / 100) }}</span>
                    </div>

                    <div class="summary-row shipping">
                        <span>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø´Ø­Ù†' : 'Shipping' }}</span>
                        <span *ngIf="shipping > 0">{{ formatPrice(shipping) }}</span>
                        <span *ngIf="shipping === 0" class="free">
                            {{ i18n.currentLang === 'ar' ? 'Ù…Ø¬Ø§Ù†ÙŠ' : 'Free' }}
                        </span>
                    </div>

                    <div *ngIf="shipping > 0" class="free-shipping-note">
                        <i class="fa-solid fa-truck"></i>
                        {{ i18n.currentLang === 'ar'
                        ? 'Ø£Ø¶Ù ' + formatPrice(200 - subtotal) + ' Ù„Ù„Ø´Ø­Ù† Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ'
                        : 'Add ' + formatPrice(200 - subtotal) + ' for free shipping'
                        }}
                    </div>
                </div>

                <!-- Total -->
                <div class="summary-total">
                    <span>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ' : 'Total' }}</span>
                    <span class="total-amount">{{ formatPrice(total) }}</span>
                </div>

                <!-- Checkout Button -->
                <button class="btn-checkout" (click)="proceedToCheckout()">
                    <i class="fa-solid fa-lock"></i>
                    {{ i18n.currentLang === 'ar' ? 'Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡' : 'Proceed to Checkout' }}
                </button>

                <!-- Login Warning -->
                <p *ngIf="showLoginWarning" class="login-warning">
                    <i class="fa-solid fa-exclamation-circle"></i>
                    {{ i18n.currentLang === 'ar' ? 'ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡' : 'Please login first to
                    checkout' }}
                    <a routerLink="/auth/login">{{ i18n.currentLang === 'ar' ? 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„' : 'Login' }}</a>
                </p>

                <!-- Continue Shopping -->
                <a routerLink="/products" class="continue-shopping">
                    <i class="fa-solid fa-arrow-left"></i>
                    {{ i18n.currentLang === 'ar' ? 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚' : 'Continue Shopping' }}
                </a>

                <!-- Trust Badges -->
                <div class="trust-badges">
                    <div class="badge">
                        <i class="fa-solid fa-shield-halved"></i>
                        <span>{{ i18n.currentLang === 'ar' ? 'Ø¯ÙØ¹ Ø¢Ù…Ù†' : 'Secure Payment' }}</span>
                    </div>
                    <div class="badge">
                        <i class="fa-solid fa-rotate-left"></i>
                        <span>{{ i18n.currentLang === 'ar' ? 'Ø¥Ø±Ø¬Ø§Ø¹ Ø³Ù‡Ù„' : 'Easy Returns' }}</span>
                    </div>
                </div>
            </div>

            <!-- Ø¨Ø¹Ø¯ Order Summary Ù…Ø¨Ø§Ø´Ø±Ø© -->

            <!-- Admin Promo Codes Management -->
            <div *ngIf="isAdmin" class="admin-promo-section">
                <div class="admin-header">
                    <h3>
                        <i class="fa-solid fa-ticket"></i>
                        {{ i18n.currentLang === 'ar' ? 'Ø¥Ø¯Ø§Ø±Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø®ØµÙ…' : 'Manage Promo Codes' }}
                    </h3>
                    <button class="btn-add-promo" (click)="openPromoDialog()">
                        <i class="fa-solid fa-plus"></i>
                        {{ i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯' : 'Add Code' }}
                    </button>
                </div>

                <!-- Promo Codes List -->
                <div class="promo-codes-list">
                    <div *ngIf="isLoadingPromos" class="loading-mini">
                        <i class="fa-solid fa-spinner fa-spin"></i>
                    </div>

                    <div *ngIf="!isLoadingPromos && promoCodes.length === 0" class="empty-promos">
                        <p>{{ i18n.currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø®ØµÙ…' : 'No promo codes' }}</p>
                    </div>

                    <div *ngFor="let promo of promoCodes" class="promo-item" [class.inactive]="!promo.isActive">
                        <div class="promo-info">
                            <span class="promo-code-badge">{{ promo.code }}</span>
                            <span class="promo-value">
                                {{ promo.type === 'Percentage' ? promo.value + '%' : formatPrice(promo.value) }}
                            </span>
                        </div>
                        <div class="promo-stats">
                            <span class="usage">
                                {{ promo.usedCount }}/{{ promo.maxUsageCount || 'âˆ' }}
                            </span>
                        </div>
                        <div class="promo-actions">
                            <button class="btn-toggle" (click)="togglePromoStatus(promo)"
                                [class.active]="promo.isActive">
                                <i class="fa-solid" [ngClass]="promo.isActive ? 'fa-toggle-on' : 'fa-toggle-off'"></i>
                            </button>
                            <button class="btn-delete-promo" (click)="openDeletePromoDialog(promo)">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Promo Dialog -->
            <div class="dialog-overlay" [class.show]="showPromoDialog" (click)="closePromoDialog()">
                <div class="dialog promo-dialog" (click)="$event.stopPropagation()">
                    <div class="dialog-header">
                        <h3>{{ i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø®ØµÙ…' : 'Add Promo Code' }}</h3>
                        <button class="close-btn" (click)="closePromoDialog()">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>

                    <div class="dialog-body">
                        <!-- Code Input -->
                        <div class="form-group">
                            <label>{{ i18n.currentLang === 'ar' ? 'ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…' : 'Promo Code' }} *</label>
                            <input type="text" [(ngModel)]="promoForm.code"
                                [placeholder]="i18n.currentLang === 'ar' ? 'Ù…Ø«Ø§Ù„: SAVE20' : 'e.g. SAVE20'"
                                maxlength="20" (input)="promoForm.code = promoForm.code.toUpperCase()" />
                        </div>

                        <!-- Type & Value -->
                        <div class="form-row">
                            <div class="form-group">
                                <label>{{ i18n.currentLang === 'ar' ? 'Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…' : 'Discount Type' }}</label>
                                <select [(ngModel)]="promoForm.type">
                                    <option [value]="0">{{ i18n.currentLang === 'ar' ? 'Ùª Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ©' : '% Percentage'
                                        }}</option>
                                    <option [value]="1">{{ i18n.currentLang === 'ar' ? 'ğŸ’° Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª' : 'ğŸ’° Fixed
                                        Amount' }}</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ù‚ÙŠÙ…Ø©' : 'Value' }} *</label>
                                <input type="number" [(ngModel)]="promoForm.value" min="0"
                                    [placeholder]="promoForm.type == 0 ? '10' : '50'" />
                            </div>
                        </div>

                        <!-- Limits -->
                        <div class="form-row">
                            <div class="form-group">
                                <label>{{ i18n.currentLang === 'ar' ? 'Ø£Ù‚ØµÙ‰ Ø®ØµÙ…' : 'Max Discount' }}</label>
                                <input type="number" [(ngModel)]="promoForm.maxDiscount" min="0"
                                    [placeholder]="i18n.currentLang === 'ar' ? 'Ø¨Ø¯ÙˆÙ† Ø­Ø¯' : 'No limit'" />
                            </div>

                            <div class="form-group">
                                <label>{{ i18n.currentLang === 'ar' ? 'Ø£Ù‚Ù„ Ù‚ÙŠÙ…Ø© Ù„Ù„Ø·Ù„Ø¨' : 'Min Order Amount' }}</label>
                                <input type="number" [(ngModel)]="promoForm.minOrderAmount" min="0"
                                    [placeholder]="i18n.currentLang === 'ar' ? 'Ø¨Ø¯ÙˆÙ† Ø­Ø¯' : 'No minimum'" />
                            </div>
                        </div>

                        <!-- Usage Limits -->
                        <div class="form-row">
                            <div class="form-group">
                                <label>{{ i18n.currentLang === 'ar' ? 'Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙ„ÙŠ' : 'Total Usage Limit'
                                    }}</label>
                                <input type="number" [(ngModel)]="promoForm.maxUsageCount" min="1"
                                    [placeholder]="i18n.currentLang === 'ar' ? 'ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯' : 'Unlimited'" />
                            </div>

                            <div class="form-group">
                                <label>{{ i18n.currentLang === 'ar' ? 'Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…' : 'Per User Limit' }}</label>
                                <input type="number" [(ngModel)]="promoForm.maxUsagePerUser" min="1"
                                    [placeholder]="i18n.currentLang === 'ar' ? 'ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯' : 'Unlimited'" />
                            </div>
                        </div>

                        <!-- Dates -->
                        <div class="form-row">
                            <div class="form-group">
                                <label>{{ i18n.currentLang === 'ar' ? 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡' : 'Start Date' }}</label>
                                <input type="datetime-local" [(ngModel)]="promoForm.startDate" />
                            </div>
                            <br>
                            <div class="form-group w-100">
                                <label>{{ i18n.currentLang === 'ar' ? 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡' : 'End Date' }}</label>
                                <input type="datetime-local" class="w-100" [(ngModel)]="promoForm.endDate" />
                            </div>
                        </div>

                        <!-- Descriptions -->
                        <div class="form-group">
                            <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Arabic Description' }}</label>
                            <input type="text" [(ngModel)]="promoForm.descriptionAr"
                                [placeholder]="i18n.currentLang === 'ar' ? 'Ø®ØµÙ… Ø®Ø§Øµ...' : 'Special discount...'" />
                        </div>

                        <div class="form-group">
                            <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©' : 'English Description' }}</label>
                            <input type="text" [(ngModel)]="promoForm.descriptionEn"
                                [placeholder]="i18n.currentLang === 'ar' ? 'Special discount...' : 'Special discount...'" />
                        </div>
                    </div>

                    <div class="dialog-footer">
                        <button class="btn-cancel" (click)="closePromoDialog()">
                            {{ i18n.currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
                        </button>
                        <button class="btn-save" (click)="savePromoCode()" [disabled]="isSavingPromo">
                            <i *ngIf="isSavingPromo" class="fa-solid fa-spinner fa-spin"></i>
                            <i *ngIf="!isSavingPromo" class="fa-solid fa-check"></i>
                            <span>{{ i18n.currentLang === 'ar' ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯' : 'Create Code' }}</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Item Dialog -->
<div class="dialog-overlay" [class.show]="showDeleteDialog" (click)="closeDeleteDialog()">
    <div class="dialog" (click)="$event.stopPropagation()">
        <div class="dialog-icon">
            <i class="fa-solid fa-trash"></i>
        </div>
        <h3>{{ i18n.currentLang === 'ar' ? 'Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬' : 'Remove Item' }}</h3>
        <p>{{ i18n.currentLang === 'ar' ? 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ' : 'Remove this item from your cart?' }}</p>

        <div *ngIf="itemToDelete" class="delete-item-preview">
            <img [src]="getImageUrl(itemToDelete.productImage)" [alt]="getName(itemToDelete)" />
            <span>{{ getName(itemToDelete) }}</span>
        </div>

        <div class="dialog-actions">
            <button class="btn-cancel" (click)="closeDeleteDialog()">
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
            </button>
            <button class="btn-confirm" (click)="confirmDelete()" [disabled]="isDeleting">
                <i class="fa-solid" [ngClass]="isDeleting ? 'fa-spinner fa-spin' : 'fa-trash'"></i>
                {{ isDeleting
                ? (i18n.currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...' : 'Removing...')
                : (i18n.currentLang === 'ar' ? 'Ø­Ø°Ù' : 'Remove')
                }}
            </button>
        </div>
    </div>
</div>

<!-- Clear Cart Dialog -->
<div class="dialog-overlay" [class.show]="showClearDialog" (click)="closeClearDialog()">
    <div class="dialog" (click)="$event.stopPropagation()">
        <div class="dialog-icon warning">
            <i class="fa-solid fa-exclamation-triangle"></i>
        </div>
        <h3>{{ i18n.currentLang === 'ar' ? 'ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©' : 'Clear Cart' }}</h3>
        <p>{{ i18n.currentLang === 'ar' ? 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ' : 'Remove all items from your cart?' }}
        </p>

        <div class="dialog-actions">
            <button class="btn-cancel" (click)="closeClearDialog()">
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
            </button>
            <button class="btn-confirm" (click)="confirmClear()" [disabled]="isClearing">
                <i class="fa-solid" [ngClass]="isClearing ? 'fa-spinner fa-spin' : 'fa-trash'"></i>
                {{ isClearing
                ? (i18n.currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ±ÙŠØº...' : 'Clearing...')
                : (i18n.currentLang === 'ar' ? 'ØªÙØ±ÙŠØº' : 'Clear All')
                }}
            </button>
        </div>
    </div>
</div>

<!-- Toast -->
<div class="toast" [class.show]="toast.show" [class.success]="toast.type === 'success'"
    [class.error]="toast.type === 'error'">
    <i class="fa-solid" [ngClass]="toast.type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'"></i>
    <span>{{ toast.message }}</span>
</div>

<div class="dialog-overlay" [class.show]="showDeletePromoDialog" (click)="closeDeletePromoDialog()">
    <div class="dialog" (click)="$event.stopPropagation()">
        <div class="dialog-icon delete-promo">
            <i class="fa-solid fa-ticket"></i>
        </div>
        <h3>{{ i18n.currentLang === 'ar' ? 'Ø­Ø°Ù ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…' : 'Delete Promo Code' }}</h3>
        <p>{{ i18n.currentLang === 'ar' ? 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ØŸ' : 'Delete this promo code?' }}</p>

        <div *ngIf="promoToDelete" class="delete-promo-preview">
            <span class="promo-code-badge">{{ promoToDelete.code }}</span>
            <span class="promo-value">
                {{ promoToDelete.type === 'Percentage' ? promoToDelete.value + '%' : formatPrice(promoToDelete.value) }}
            </span>
        </div>

        <div class="dialog-actions">
            <button class="btn-cancel" (click)="closeDeletePromoDialog()" [disabled]="isDeletingPromo">
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
            </button>
            <button class="btn-confirm" (click)="confirmDeletePromo()" [disabled]="isDeletingPromo">
                <i class="fa-solid" [ngClass]="isDeletingPromo ? 'fa-spinner fa-spin' : 'fa-trash'"></i>
                {{ isDeletingPromo
                ? (i18n.currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...' : 'Deleting...')
                : (i18n.currentLang === 'ar' ? 'Ø­Ø°Ù' : 'Delete')
                }}
            </button>
        </div>
    </div>
</div>


<!-- Payment Method Dialog -->
<div class="dialog-overlay" [class.show]="showPaymentDialog" (click)="closePaymentDialog()">
    <div class="dialog payment-dialog" (click)="$event.stopPropagation()">
        <!-- Header -->
        <div class="payment-header">
            <div class="payment-icon-wrapper">
                <div class="payment-icon-bg"></div>
                <i class="fa-solid fa-credit-card"></i>
            </div>
            <h3>{{ i18n.currentLang === 'ar' ? 'Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹' : 'Choose Payment Method' }}</h3>
            <p class="payment-total">
                {{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨' : 'Amount Due' }}
                <strong>{{ formatPrice(total) }}</strong>
            </p>
            <button class="close-btn" (click)="closePaymentDialog()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>

        <!-- Payment Methods -->
        <div class="payment-methods">
            <button class="payment-option" [class.selected]="selectedPayment === 'visa'"
                (click)="selectedPayment = 'visa'">
                <div class="option-icon visa-icon">
                    <i class="fa-brands fa-cc-visa"></i>
                </div>
                <div class="option-info">
                    <span class="option-name">Visa / Mastercard</span>
                    <span class="option-desc">{{ i18n.currentLang === 'ar' ? 'Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù† Ø£Ùˆ Ù…Ø¯Ù‰' : 'Credit or debit
                        card' }}</span>
                </div>
                <div class="option-check">
                    <i class="fa-solid" [ngClass]="selectedPayment === 'visa' ? 'fa-circle-check' : 'fa-circle'"></i>
                </div>
            </button>

            <button class="payment-option" [class.selected]="selectedPayment === 'vodafone'"
                (click)="selectedPayment = 'vodafone'">
                <div class="option-icon vodafone-icon">
                    <i class="fa-solid fa-mobile-screen-button"></i>
                </div>
                <div class="option-info">
                    <span class="option-name">Vodafone Cash</span>
                    <span class="option-desc">{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø­ÙØ¸Ø©' : 'Pay via mobile
                        wallet' }}</span>
                </div>
                <div class="option-check">
                    <i class="fa-solid"
                        [ngClass]="selectedPayment === 'vodafone' ? 'fa-circle-check' : 'fa-circle'"></i>
                </div>
            </button>

            <button class="payment-option" [class.selected]="selectedPayment === 'instapay'"
                (click)="selectedPayment = 'instapay'">
                <div class="option-icon instapay-icon">
                    <i class="fa-solid fa-building-columns"></i>
                </div>
                <div class="option-info">
                    <span class="option-name">InstaPay</span>
                    <span class="option-desc">{{ i18n.currentLang === 'ar' ? 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ ÙÙˆØ±ÙŠ' : 'Instant bank transfer'
                        }}</span>
                </div>
                <div class="option-check">
                    <i class="fa-solid"
                        [ngClass]="selectedPayment === 'instapay' ? 'fa-circle-check' : 'fa-circle'"></i>
                </div>
            </button>

            <button class="payment-option" [class.selected]="selectedPayment === 'cash'"
                (click)="selectedPayment = 'cash'">
                <div class="option-icon cash-icon">
                    <i class="fa-solid fa-money-bill-wave"></i>
                </div>
                <div class="option-info">
                    <span class="option-name">{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…' : 'Cash on Delivery'
                        }}</span>
                    <span class="option-desc">{{ i18n.currentLang === 'ar' ? 'Ø§Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªÙˆØµÙŠÙ„' : 'Pay cash when
                        you receive' }}</span>
                </div>
                <div class="option-check">
                    <i class="fa-solid" [ngClass]="selectedPayment === 'cash' ? 'fa-circle-check' : 'fa-circle'"></i>
                </div>
            </button>
        </div>

        <!-- Secure Badge -->
        <div class="secure-badge">
            <i class="fa-solid fa-shield-halved"></i>
            {{ i18n.currentLang === 'ar' ? 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ø´ÙØ±Ø© ÙˆØ¢Ù…Ù†Ø©' : 'All transactions are encrypted & secure' }}
        </div>

        <!-- Actions -->
        <div class="payment-actions">
            <button class="btn-cancel" (click)="closePaymentDialog()">
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
            </button>
            <button class="btn-pay" [disabled]="!selectedPayment" (click)="confirmPayment()">
                <i class="fa-solid fa-lock"></i>
                {{ i18n.currentLang === 'ar' ? 'Ø§Ø¯ÙØ¹ ' + formatPrice(total) : 'Pay ' + formatPrice(total) }}
            </button>
        </div>
    </div>
</div>