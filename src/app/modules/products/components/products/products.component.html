<!-- src/app/pages/products/products.component.html -->

<div class="products-page">
    <!-- Hero -->
    <section class="hero">
        <div class="hero-bg"></div>
        <div class="hero-content">
            <h1>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' : 'Products' }}</h1>
            <p>{{ i18n.currentLang === 'ar' ? 'Ø§ÙƒØªØ´Ù Ù…Ø¬Ù…ÙˆØ¹ØªÙ†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' : 'Discover our amazing collection'
                }}</p>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- POPULAR BRANDS + BEST SELLERS BANNER          -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="brands-section">
        <!-- Brands Bar -->
        <div class="brands-bar">
            <div class="brands-bar-header">
                <span class="brands-title">
                    <i class="fa-solid fa-fire"></i>
                    {{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©' : 'Popular Brands' }}
                </span>
            </div>
            <div class="brands-scroll-track">
                <button *ngFor="let brand of brands" class="brand-pill"
                    [class.brand-pill--active]="selectedBrandId === brand.id" (click)="onBrandBannerSelect(brand)">
                    <div class="brand-pill-img">
                        <img [src]="getBrandImage(brand)" [alt]="getName(brand)"
                            (error)="handleBrandImgError($event)" />
                    </div>
                    <span class="brand-pill-name">{{ getName(brand) }}</span>
                </button>
            </div>
        </div>

        <!-- Best Sellers Banner -->
        <div class="brand-banner" *ngIf="selectedBrand && brandBestSellers.length > 0">
            <div class="brand-banner-header">
                <div class="brand-banner-title">
                    <img [src]="getBrandImage(selectedBrand)" [alt]="getName(selectedBrand)" class="brand-banner-logo"
                        (error)="handleBrandImgError($event)" />
                    <div>
                        <h3>{{ getName(selectedBrand) }}</h3>
                        <span>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹' : 'Best Sellers' }}</span>
                    </div>
                </div>

                <!-- Category Tabs -->
                <div class="brand-category-tabs">
                    <button class="brand-cat-tab" [class.active]="!selectedBrandCategoryId"
                        (click)="onBrandCategorySelect(null)">
                        {{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙƒÙ„' : 'All' }}
                    </button>
                    <button *ngFor="let cat of brandCategories" class="brand-cat-tab"
                        [class.active]="selectedBrandCategoryId === cat.id" (click)="onBrandCategorySelect(cat.id)">
                        {{ getName(cat) }}
                    </button>
                </div>
            </div>

            <!-- Products Scroll -->
            <div class="brand-products-track" *ngIf="!isBrandLoading">
                <a *ngFor="let product of brandBestSellers" [routerLink]="['/products', product.id]"
                    class="brand-product-card">
                    <div class="brand-product-img">
                        <img [src]="getImageUrl(product.mainImage)" [alt]="getName(product)" />
                        <span *ngIf="product.discountPercentage" class="brand-product-discount">
                            -{{ product.discountPercentage }}%
                        </span>
                    </div>
                    <div class="brand-product-info">
                        <p class="brand-product-name">{{ getName(product) }}</p>
                        <div class="brand-product-price">
                            <span class="brand-product-current">{{ formatPrice(product.price) }}</span>
                            <span *ngIf="product.originalPrice" class="brand-product-original">
                                {{ formatPrice(product.originalPrice) }}
                            </span>
                        </div>
                        <div class="brand-product-rating">
                            <i class="fa-solid fa-star"></i>
                            <span>{{ product.rating | number:'1.1-1' }}</span>
                            <span class="brand-product-reviews">({{ product.reviewCount }})</span>
                        </div>
                    </div>
                </a>
            </div>

            <!-- Loading -->
            <div class="brand-banner-loading" *ngIf="isBrandLoading">
                <div class="brand-spinner"></div>
            </div>
        </div>
    </section>

    <div class="main-container">
        <!-- Mobile Filter Button -->
        <button class="mobile-filter-btn" (click)="toggleMobileFilters()">
            <i class="fa-solid fa-sliders"></i>
            <span>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙÙ„Ø§ØªØ±' : 'Filters' }}</span>
            <span *ngIf="getActiveFiltersCount() > 0" class="filter-badge">{{ getActiveFiltersCount() }}</span>
        </button>

        <div class="content-wrapper">
            <!-- Sidebar Filters -->
            <aside class="sidebar" [class.show]="showMobileFilters">
                <div class="sidebar-header">
                    <h3>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙÙ„Ø§ØªØ±' : 'Filters' }}</h3>
                    <button class="close-sidebar" (click)="toggleMobileFilters()">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>

                <div class="sidebar-content">
                    <!-- ğŸ†• Categories with Hierarchy -->
                    <div class="filter-section">
                        <h4>
                            <i class="fa-solid fa-layer-group"></i>
                            {{ i18n.currentLang === 'ar' ? 'Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª' : 'Categories' }}
                        </h4>

                        <div class="category-tree">
                            <!-- All Categories Option -->
                            <div class="category-item" [class.active]="!filter.categoryId"
                                (click)="onCategoryChange(null)">
                                <span class="category-radio">
                                    <span class="radio-dot" *ngIf="!filter.categoryId"></span>
                                </span>
                                <span class="category-name">
                                    {{ i18n.currentLang === 'ar' ? 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª' : 'All Categories' }}
                                </span>
                            </div>

                            <!-- Parent Categories -->
                            <ng-container *ngFor="let category of categories; trackBy: trackByCategory">
                                <div class="category-parent">
                                    <!-- Parent Item -->
                                    <div class="category-item parent-item"
                                        [class.active]="isCategorySelected(category.id)"
                                        [class.has-active-child]="isChildSelected(category)"
                                        (click)="onParentCategorySelect(category)">

                                        <!-- Expand/Collapse Button -->
                                        <button *ngIf="hasChildren(category)" class="expand-btn"
                                            [class.expanded]="isCategoryExpanded(category.id)"
                                            (click)="toggleCategoryExpand(category.id, $event)">
                                            <i class="fa-solid"
                                                [ngClass]="isCategoryExpanded(category.id) ? 'fa-chevron-down' : 'fa-chevron-left'"></i>
                                        </button>
                                        <span class="no-expand" *ngIf="!hasChildren(category)"></span>

                                        <!-- Radio -->
                                        <span class="category-radio">
                                            <span class="radio-dot" *ngIf="isCategorySelected(category.id)"></span>
                                        </span>

                                        <!-- Icon & Name -->
                                        <i class="fa-solid fa-folder category-icon"></i>
                                        <span class="category-name">{{ getName(category) }}</span>

                                        <!-- Count -->
                                        <span class="category-count">{{ getTotalProductCount(category) }}</span>
                                    </div>

                                    <!-- Children (Subcategories) -->
                                    <div class="category-children" *ngIf="hasChildren(category)"
                                        [class.expanded]="isCategoryExpanded(category.id)">

                                        <div *ngFor="let child of category.children" class="category-item child-item"
                                            [class.active]="isCategorySelected(child.id)"
                                            (click)="onChildCategorySelect(child, $event)">

                                            <span class="child-indent">
                                                <i class="fa-solid fa-turn-up fa-rotate-90"></i>
                                            </span>

                                            <span class="category-radio">
                                                <span class="radio-dot" *ngIf="isCategorySelected(child.id)"></span>
                                            </span>

                                            <span class="category-name">{{ getName(child) }}</span>
                                            <span class="category-count">{{ child.productCount }}</span>
                                        </div>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </div>

                    <!-- Brands -->
                    <div class="filter-section">
                        <h4>
                            <i class="fa-solid fa-tag"></i>
                            {{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©' : 'Brands' }}
                        </h4>
                        <div class="filter-list">
                            <label class="filter-item" [class.active]="!filter.brandId">
                                <input type="radio" name="brand" [checked]="!filter.brandId"
                                    (change)="onBrandChange(null)" />
                                <span class="radio-custom"></span>
                                <span class="filter-label">{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙƒÙ„' : 'All' }}</span>
                            </label>
                            <label *ngFor="let brand of brands" class="filter-item"
                                [class.active]="filter.brandId === brand.id">
                                <input type="radio" name="brand" [checked]="filter.brandId === brand.id"
                                    (change)="onBrandChange(brand.id)" />
                                <span class="radio-custom"></span>
                                <span class="filter-label">{{ getName(brand) }}</span>
                                <span class="filter-count">{{ brand.productCount }}</span>
                            </label>
                        </div>
                    </div>

                    <!-- Price Range -->
                    <div class="filter-section">
                        <h4>
                            <i class="fa-solid fa-money-bill-wave"></i>
                            {{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø³Ø¹Ø±' : 'Price' }}
                        </h4>
                        <div class="price-inputs">
                            <input type="number" [(ngModel)]="minPrice"
                                [placeholder]="i18n.currentLang === 'ar' ? 'Ù…Ù†' : 'Min'" />
                            <span>-</span>
                            <input type="number" [(ngModel)]="maxPrice"
                                [placeholder]="i18n.currentLang === 'ar' ? 'Ø¥Ù„Ù‰' : 'Max'" />
                            <button class="price-btn" (click)="onPriceFilter()">
                                <i class="fa-solid fa-check"></i>
                            </button>
                        </div>
                    </div>

                    <!-- In Stock -->
                    <div class="filter-section">
                        <label class="checkbox-filter">
                            <input type="checkbox" [checked]="filter.inStock" (change)="onInStockChange($event)" />
                            <span class="checkbox-custom"></span>
                            <span>{{ i18n.currentLang === 'ar' ? 'Ù…ØªÙˆÙØ± ÙÙ‚Ø·' : 'In Stock Only' }}</span>
                        </label>
                    </div>

                    <!-- Clear Filters -->
                    <button *ngIf="getActiveFiltersCount() > 0" class="clear-filters-btn" (click)="clearFilters()">
                        <i class="fa-solid fa-trash"></i>
                        {{ i18n.currentLang === 'ar' ? 'Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±' : 'Clear Filters' }}
                    </button>
                </div>

                <!-- Mobile Apply Button -->
                <div class="sidebar-footer">
                    <button class="apply-btn" (click)="toggleMobileFilters()">
                        {{ i18n.currentLang === 'ar' ? 'ØªØ·Ø¨ÙŠÙ‚' : 'Apply' }} ({{ totalCount }})
                    </button>
                </div>
            </aside>

            <!-- Overlay -->
            <div class="sidebar-overlay" [class.show]="showMobileFilters" (click)="toggleMobileFilters()"></div>

            <!-- Products Content -->
            <main class="products-content">
                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="toolbar-right">
                        <div class="search-box">
                            <i class="fa-solid fa-search"></i>
                            <input type="text" [value]="filter.search || ''" (input)="onSearch($event)"
                                [placeholder]="i18n.currentLang === 'ar' ? 'Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...' : 'Search products...'" />
                        </div>
                        <span class="results-count">
                            {{ totalCount }} {{ i18n.currentLang === 'ar' ? 'Ù…Ù†ØªØ¬' : 'products' }}
                        </span>
                    </div>

                    <div class="toolbar-left">
                        <button class="btn-add" (click)="openAddDialog()" *ngIf="isAdmin">
                            <i class="fa-solid fa-plus"></i>
                            <span>{{ i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬' : 'Add Product' }}</span>
                        </button>

                        <div class="sort-dropdown">
                            <select [(ngModel)]="selectedSort" (change)="onSortChange(selectedSort)">
                                <option *ngFor="let opt of sortOptions" [value]="opt.value">
                                    {{ i18n.currentLang === 'ar' ? opt.label.ar : opt.label.en }}
                                </option>
                            </select>
                        </div>

                        <div class="view-btns">
                            <button [class.active]="viewMode === 'grid'" (click)="viewMode = 'grid'">
                                <i class="fa-solid fa-th-large"></i>
                            </button>
                            <button [class.active]="viewMode === 'list'" (click)="viewMode = 'list'">
                                <i class="fa-solid fa-list"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ†• Active Filters Tags (Updated with hierarchy support) -->
                <div *ngIf="getActiveFiltersCount() > 0" class="active-filters">
                    <!-- Category Filter Tag -->
                    <span *ngIf="filter.categoryId" class="filter-tag category-tag">
                        <i class="fa-solid fa-folder"></i>
                        {{ getSelectedCategoryName() }}
                        <i class="fa-solid fa-times" (click)="onCategoryChange(null)"></i>
                    </span>

                    <!-- Brand Filter Tag -->
                    <span *ngIf="filter.brandId" class="filter-tag brand-tag">
                        <i class="fa-solid fa-tag"></i>
                        {{ getSelectedBrandName() }}
                        <i class="fa-solid fa-times" (click)="onBrandChange(null)"></i>
                    </span>

                    <!-- Price Filter Tag -->
                    <span *ngIf="filter.minPrice || filter.maxPrice" class="filter-tag price-tag">
                        <i class="fa-solid fa-money-bill"></i>
                        {{ filter.minPrice || 0 }} - {{ filter.maxPrice || 'âˆ' }}
                        <i class="fa-solid fa-times" (click)="clearPriceFilter()"></i>
                    </span>
                </div>

                <!-- Loading -->
                <div *ngIf="isLoading" class="loading">
                    <div class="spinner"></div>
                    <p>{{ i18n.currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : 'Loading...' }}</p>
                </div>

                <!-- Empty -->
                <div *ngIf="!isLoading && products.length === 0" class="empty">
                    <i class="fa-solid fa-box-open"></i>
                    <h3>{{ i18n.currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª' : 'No products found' }}</h3>
                    <p>{{ i18n.currentLang === 'ar' ? 'Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ±' : 'Try changing the filters' }}</p>
                    <button class="btn-primary" (click)="clearFilters()">
                        {{ i18n.currentLang === 'ar' ? 'Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±' : 'Clear Filters' }}
                    </button>
                </div>

                <!-- Grid View -->
                <div *ngIf="!isLoading && products.length > 0 && viewMode === 'grid'" class="products-grid">
                    <div *ngFor="let product of products; trackBy: trackByProduct" class="product-card"
                        [class.inactive]="!product.isActive">
                        <!-- Inactive Badge -->
                        <span *ngIf="!product.isActive" class="inactive-badge">
                            <i class="fa-solid fa-eye-slash"></i>
                            {{ i18n.currentLang === 'ar' ? 'ØºÙŠØ± Ù…ØªØ§Ø­' : 'Inactive' }}
                        </span>

                        <button class="action-btn approve" *ngIf="isAdmin && product.status === 0"
                            (click)="approveProduct(product)"
                            title="{{ i18n.currentLang === 'ar' ? 'Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬' : 'Approve Product' }}">
                            <i class="fa-solid fa-check"></i>
                        </button>

                        <!-- Actions -->
                        <div class="card-actions">
                            <button class="action-btn edit" *ngIf="isAdmin" (click)="openEditDialog(product)">
                                <i class="fa-solid fa-pen"></i>
                            </button>
                            <button class="action-btn delete" *ngIf="isAdmin" (click)="openDeleteDialog(product)">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>

                        <!-- Badges -->
                        <span *ngIf="product.discountPercentage" class="discount-badge">
                            -{{ product.discountPercentage }}%
                        </span>
                        <span *ngIf="product.isFeatured" class="featured-badge">
                            <i class="fa-solid fa-star"></i>
                        </span>

                        <!-- Image - Clickable -->
                        <div class="product-image" (click)="goToProduct(product.id)">
                            <img [src]="getImageUrl(product.mainImage)" [alt]="getName(product)" loading="lazy" />
                            <div class="image-overlay">
                                <button class="quick-view-btn" (click)="goToProduct(product.id)">
                                    <i class="fa-solid fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Info - Clickable -->
                        <div class="product-info" (click)="goToProduct(product.id)">
                            <span class="product-category">{{ getCategoryName(product) }}</span>
                            <h3 class="product-name">{{ getName(product) }}</h3>
                            <h3 class="product-description">{{ getDescription(product) }}</h3>

                            <div class="product-rating">
                                <div class="stars">
                                    <i *ngFor="let star of getStars(product.rating)" class="fa-solid fa-star"
                                        [class.filled]="star === 1"></i>
                                </div>
                                <span class="review-count">({{ product.reviewCount }})</span>
                            </div>

                            <div class="product-price">
                                <span class="current-price">{{ formatPrice(product.price) }}</span>
                                <span *ngIf="product.originalPrice" class="original-price">
                                    {{ formatPrice(product.originalPrice) }}
                                </span>
                            </div>

                            <span class="stock-status w-max" [class.in-stock]="product.stock > 0"
                                [class.out-of-stock]="product.stock === 0">
                                {{ product.stock > 0
                                ? (i18n.currentLang === 'ar' ? 'Ù…ØªÙˆÙØ±' : 'In Stock')
                                : (i18n.currentLang === 'ar' ? 'ØºÙŠØ± Ù…ØªÙˆÙØ±' : 'Out of Stock')
                                }}
                            </span>
                        </div>

                        <!-- Add to Cart -->
                        <button class="add-to-cart-btn" (click)="addToCart(product, $event)"
                            [disabled]="product.stock <= 0">
                            <i class="fa-solid fa-cart-plus"></i>
                            <span>{{ i18n.currentLang === 'ar' ? 'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©' : 'Add to Cart' }}</span>
                        </button>
                    </div>
                </div>

                <!-- List View -->
                <div *ngIf="!isLoading && products.length > 0 && viewMode === 'list'" class="products-list">
                    <a *ngFor="let product of products; trackBy: trackByProduct"
                        [routerLink]="['/products', product.id]" class="product-list-item">
                        <!-- Image -->
                        <div class="list-image">
                            <img [src]="getImageUrl(product.mainImage)" [alt]="getName(product)" loading="lazy" />
                            <span *ngIf="product.discountPercentage" class="discount-badge">
                                -{{ product.discountPercentage }}%
                            </span>
                        </div>

                        <!-- Info -->
                        <div class="list-info">
                            <span class="product-category">{{ getCategoryName(product) }}</span>
                            <h3 class="product-name">{{ getName(product) }}</h3>

                            <div class="product-rating">
                                <div class="stars">
                                    <i *ngFor="let star of getStars(product.rating)" class="fa-solid fa-star"
                                        [class.filled]="star === 1"></i>
                                </div>
                                <span class="review-count">({{ product.reviewCount }})</span>
                            </div>

                            <span class="stock-status mx-auto" [class.in-stock]="product.stock > 0">
                                {{ product.stock > 0
                                ? (i18n.currentLang === 'ar' ? 'Ù…ØªÙˆÙØ±' : 'In Stock')
                                : (i18n.currentLang === 'ar' ? 'ØºÙŠØ± Ù…ØªÙˆÙØ±' : 'Out of Stock')
                                }}
                            </span>
                        </div>

                        <!-- Price & Action -->
                        <div class="list-action">
                            <div class="product-price">
                                <span class="current-price">{{ formatPrice(product.price) }}</span>
                                <span *ngIf="product.originalPrice" class="original-price">
                                    {{ formatPrice(product.originalPrice) }}
                                </span>
                            </div>

                            <button class="add-to-cart-btn" (click)="addToCart(product, $event)"
                                [disabled]="product.stock <= 0">
                                <i class="fa-solid fa-cart-plus"></i>
                            </button>
                        </div>
                    </a>
                </div>

                <!-- Pagination -->
                <div *ngIf="!isLoading && products.length > 0 && totalPages > 1" class="pagination">
                    <button class="page-btn prev" (click)="prevPage()" [disabled]="!hasPrev"
                        [class.disabled]="!hasPrev">
                        <i class="fa-solid fa-chevron-right"></i>
                        <span class="btn-text">{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø³Ø§Ø¨Ù‚' : 'Previous' }}</span>
                    </button>

                    <div class="page-numbers">
                        <button *ngIf="getPageNumbers()[0] > 1" class="page-num" (click)="goToPage(1)">1</button>
                        <span *ngIf="getPageNumbers()[0] > 2" class="dots">...</span>

                        <button *ngFor="let page of getPageNumbers()" class="page-num"
                            [class.active]="page === currentPage" (click)="goToPage(page)">
                            {{ page }}
                        </button>

                        <span *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages - 1"
                            class="dots">...</span>
                        <button *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages" class="page-num"
                            (click)="goToPage(totalPages)">
                            {{ totalPages }}
                        </button>
                    </div>

                    <button class="page-btn next" (click)="nextPage()" [disabled]="!hasNext"
                        [class.disabled]="!hasNext">
                        <span class="btn-text">{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ØªØ§Ù„ÙŠ' : 'Next' }}</span>
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                </div>

                <!-- Page Info -->
                <div *ngIf="!isLoading && products.length > 0" class="page-info">
                    {{ i18n.currentLang === 'ar' ? 'ØµÙØ­Ø©' : 'Page' }} {{ currentPage }}
                    {{ i18n.currentLang === 'ar' ? 'Ù…Ù†' : 'of' }} {{ totalPages }}
                    <span class="separator">|</span>
                    {{ totalCount }} {{ i18n.currentLang === 'ar' ? 'Ù…Ù†ØªØ¬' : 'products' }}
                </div>
            </main>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- ADD/EDIT PRODUCT DIALOG -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div *ngIf="showAddDialog || showEditDialog" class="dialog-overlay" (click)="onDialogBackdropClick($event)">
    <div class="dialog dialog-lg">
        <div class="dialog-header">
            <h2>{{ showAddDialog
                ? (i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯' : 'Add New Product')
                : (i18n.currentLang === 'ar' ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬' : 'Edit Product')
                }}</h2>
            <button class="close-btn" (click)="closeAllDialogs()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>

        <div class="dialog-body">
            <div class="form-grid">
                <!-- Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© -->
                <div class="form-group">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Arabic Name' }} *</label>
                    <input type="text" [(ngModel)]="productForm.nameAr"
                        [placeholder]="i18n.currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Enter Arabic name'" />
                </div>

                <!-- Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© -->
                <div class="form-group">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©' : 'English Name' }} *</label>
                    <input type="text" [(ngModel)]="productForm.nameEn"
                        [placeholder]="i18n.currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©' : 'Enter English name'" />
                </div>

                <!-- Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© -->
                <div class="form-group full-width">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Arabic Description' }}</label>
                    <textarea [(ngModel)]="productForm.descriptionAr" rows="3"
                        [placeholder]="i18n.currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Enter Arabic description'"></textarea>
                </div>

                <!-- Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© -->
                <div class="form-group full-width">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©' : 'English Description' }}</label>
                    <textarea [(ngModel)]="productForm.descriptionEn" rows="3"
                        [placeholder]="i18n.currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©' : 'Enter English description'"></textarea>
                </div>

                <!-- ğŸ†• Ø§Ù„ØªØµÙ†ÙŠÙ - Updated with hierarchy -->
                <div class="form-group">
                    <label>
                        <i class="fa-solid fa-folder"></i>
                        {{ i18n.currentLang === 'ar' ? 'Ø§Ù„ØªØµÙ†ÙŠÙ' : 'Category' }} *
                    </label>
                    <select [(ngModel)]="productForm.categoryId" class="category-select">
                        <option [ngValue]="null">
                            {{ i18n.currentLang === 'ar' ? '-- Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ --' : '-- Select Category --' }}
                        </option>

                        <!-- ğŸ†• Hierarchical options -->
                        <ng-container *ngFor="let cat of categories">
                            <!-- Parent Category -->
                            <option [ngValue]="cat.id" class="parent-option">
                                ğŸ“ {{ getName(cat) }}
                            </option>

                            <!-- Child Categories -->
                            <option *ngFor="let child of cat.children" [ngValue]="child.id" class="child-option">
                                &nbsp;&nbsp;&nbsp;â”” {{ getName(child) }}
                            </option>
                        </ng-container>
                    </select>
                </div>

                <!-- Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© -->
                <div class="form-group">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©' : 'Brand' }}</label>
                    <select [(ngModel)]="productForm.brandId">
                        <option [ngValue]="null">
                            {{ i18n.currentLang === 'ar' ? '-- Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© --' : '-- Select Brand --' }}
                        </option>
                        <option *ngFor="let brand of brands" [ngValue]="brand.id">{{ getName(brand) }}</option>
                    </select>
                </div>

                <!-- Ø§Ù„Ø³Ø¹Ø± -->
                <div class="form-group">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø³Ø¹Ø±' : 'Price' }} *</label>
                    <input type="number" [(ngModel)]="productForm.price" min="0" step="0.01" />
                </div>

                <!-- Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ -->
                <div class="form-group">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ (Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…)' : 'Original Price' }}</label>
                    <input type="number" [(ngModel)]="productForm.originalPrice" min="0" step="0.01" />
                </div>

                <!-- Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© -->
                <div class="form-group">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ©' : 'Cost Price' }}</label>
                    <input type="number" [(ngModel)]="productForm.costPrice" min="0" step="0.01" />
                </div>

                <!-- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
                <div class="form-group">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†' : 'Stock' }}</label>
                    <input type="number" [(ngModel)]="productForm.stock" min="0" />
                </div>

                <!-- Ø­Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶ -->
                <div class="form-group">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø­Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶' : 'Low Stock Threshold' }}</label>
                    <input type="number" [(ngModel)]="productForm.lowStockThreshold" min="0" />
                </div>

                <!-- Ù…Ù†ØªØ¬ Ù…Ù…ÙŠØ² -->
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" [(ngModel)]="productForm.isFeatured" />
                        <span class="checkmark"></span>
                        {{ i18n.currentLang === 'ar' ? 'Ù…Ù†ØªØ¬ Ù…Ù…ÙŠØ²' : 'Featured Product' }}
                    </label>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" [(ngModel)]="productForm.isActive" />
                        <span class="checkmark"></span>
                        {{ i18n.currentLang === 'ar' ? 'Ù…ØªÙˆÙØ± Ù„Ù„Ø¨ÙŠØ¹' : 'Available for Sale' }}
                    </label>
                </div>

                <!-- Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                <div class="form-group full-width">
                    <label>{{ i18n.currentLang === 'ar' ? 'Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' : 'Main Image' }}</label>
                    <div class="image-upload-area">
                        <input type="file" id="mainImage" accept="image/*" (change)="onMainImageSelected($event)"
                            hidden />
                        <label for="mainImage" class="upload-box" *ngIf="!mainImagePreview">
                            <i class="fa-solid fa-cloud-upload-alt"></i>
                            <span>{{ i18n.currentLang === 'ar' ? 'Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡Ø§ Ù‡Ù†Ø§' : 'Choose or drag image'
                                }}</span>
                        </label>
                        <div class="image-preview-box" *ngIf="mainImagePreview">
                            <img [src]="mainImagePreview" alt="Main Image" />
                            <button class="remove-img-btn" (click)="removeMainImage()">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ØµÙˆØ± Ø¥Ø¶Ø§ÙÙŠØ© -->
                <div class="form-group full-width">
                    <label>{{ i18n.currentLang === 'ar' ? 'ØµÙˆØ± Ø¥Ø¶Ø§ÙÙŠØ©' : 'Additional Images' }}</label>
                    <div class="multi-image-upload">
                        <input type="file" id="images" accept="image/*" multiple (change)="onImagesSelected($event)"
                            hidden />
                        <label for="images" class="upload-box small">
                            <i class="fa-solid fa-plus"></i>
                        </label>
                        <div class="image-preview-box small" *ngFor="let img of imagesPreview; let i = index">
                            <img [src]="img" alt="Image" />
                            <button class="remove-img-btn" (click)="removeImage(i)">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="dialog-footer">
            <button class="btn-cancel" (click)="closeAllDialogs()" [disabled]="isSubmitting">
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
            </button>
            <button class="btn-submit" (click)="showAddDialog ? createProduct() : updateProduct()"
                [disabled]="isSubmitting">
                <i *ngIf="isSubmitting" class="fa-solid fa-spinner fa-spin"></i>
                <span *ngIf="!isSubmitting">
                    {{ showAddDialog
                    ? (i18n.currentLang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ©' : 'Add')
                    : (i18n.currentLang === 'ar' ? 'Ø­ÙØ¸' : 'Save')
                    }}
                </span>
            </button>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- DELETE DIALOG -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div *ngIf="showDeleteDialog" class="dialog-overlay" (click)="onDialogBackdropClick($event)">
    <div class="dialog dialog-sm">
        <div class="dialog-header delete-header">
            <div class="delete-icon">
                <i class="fa-solid fa-trash"></i>
            </div>
            <h2>{{ i18n.currentLang === 'ar' ? 'Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬' : 'Delete Product' }}</h2>
        </div>
        <div class="dialog-body text-center">
            <p>
                {{ i18n.currentLang === 'ar' ? 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù' : 'Are you sure you want to delete' }}
                <strong>"{{ selectedProduct ? getName(selectedProduct) : '' }}"</strong>ØŸ
            </p>
            <p class="warning-text">
                {{ i18n.currentLang === 'ar' ? 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡' : 'This action cannot be undone' }}
            </p>
        </div>
        <div class="dialog-footer">
            <button class="btn-cancel" (click)="closeAllDialogs()" [disabled]="isSubmitting">
                {{ i18n.currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
            </button>
            <button class="btn-delete" (click)="deleteProduct()" [disabled]="isSubmitting">
                <i *ngIf="isSubmitting" class="fa-solid fa-spinner fa-spin"></i>
                <span *ngIf="!isSubmitting">{{ i18n.currentLang === 'ar' ? 'Ø­Ø°Ù' : 'Delete' }}</span>
            </button>
        </div>
    </div>
</div>

<!-- TOAST -->
<div class="toast" [class.show]="toast.show" [class.success]="toast.type === 'success'"
    [class.error]="toast.type === 'error'">
    <i class="fa-solid" [ngClass]="toast.type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'"></i>
    <span>{{ toast.message }}</span>
</div>