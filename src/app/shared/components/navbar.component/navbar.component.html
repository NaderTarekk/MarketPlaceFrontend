<!-- navbar.component.html -->

<header class="navbar">
  <div class="navbar-container">

    <!-- Logo -->
    <div class="logo cursor-pointer" routerLink="">
      <img src="noqta logo rm.png" alt="MarketPlace Logo"
        class="logo-image h-20 sm:h-23 lg:h-23 w-auto object-contain" />
    </div>

    <!-- Desktop Nav Links -->
    <nav class="nav-links desktop-nav">
      <a *ngFor="let link of navLinks" [routerLink]="link.url" (click)="handleNavClick(link)"
        class="nav-link cursor-pointer">
        {{ link.label | translate }}
      </a>
    </nav>

    <!-- Desktop Search Bar -->
    <div class="search-wrapper desktop-search">
      <div class="search-input-wrapper">
        <i class="fa-solid fa-search search-icon mr-6"></i>
        <input type="text" [placeholder]="currentLang === 'ar' ? 'ابحث عن منتج...' : 'Search products...'"
          [(ngModel)]="searchQuery" (input)="onSearchInput($event)" (keyup.enter)="onSearch()"
          (focus)="searchQuery.length >= 2 && (showSearchDropdown = true)" />
        <button *ngIf="searchQuery" class="clear-btn" (click)="searchQuery = ''; showSearchDropdown = false">
          <i class="fa-solid fa-times"></i>
        </button>
        <div class="search-btn" (click)="onSearch()">
          <i *ngIf="!isSearching" class="fa-solid fa-arrow-left"></i>
          <i *ngIf="isSearching" class="fa-solid fa-spinner fa-spin"></i>
        </div>
      </div>

      <!-- Search Dropdown -->
      <div class="search-dropdown" *ngIf="showSearchDropdown && searchResults.length > 0">
        <div class="dropdown-header">
          <span>{{ currentLang === 'ar' ? 'نتائج البحث' : 'Search Results' }}</span>
          <button (click)="showSearchDropdown = false">
            <i class="fa-solid fa-times"></i>
          </button>
        </div>

        <div class="search-results">
          <a *ngFor="let product of searchResults" class="search-result-item" (mousedown)="selectSearchResult(product)">
            <div class="result-image">
              <img [src]="getProductImage(product.mainImage)" [alt]="getProductName(product)"
                (error)="$any($event.target).src = 'assets/images/placeholder.png'" />
            </div>
            <div class="result-info">
              <span class="result-name">{{ getProductName(product) }}</span>
              <div class="result-meta">
                <span class="result-price">{{ product.price | number:'1.0-0' }} {{ currentLang === 'ar' ? 'ر.س' : 'SAR'
                  }}</span>
                <span class="result-category" *ngIf="product.categoryNameAr">
                  {{ currentLang === 'ar' ? product.categoryNameAr : product.categoryNameEn }}
                </span>
              </div>
            </div>
            <i class="fa-solid fa-chevron-left result-arrow"></i>
          </a>
        </div>

        <button class="view-all-btn" (mousedown)="onSearch()">
          <span>{{ currentLang === 'ar' ? 'عرض كل النتائج' : 'View All Results' }}</span>
          <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>

      <!-- No Results -->
      <div class="search-dropdown"
        *ngIf="showSearchDropdown && searchResults.length === 0 && !isSearching && searchQuery.length >= 2">
        <div class="no-results">
          <i class="fa-solid fa-search"></i>
          <p>{{ currentLang === 'ar' ? 'لا توجد نتائج لـ' : 'No results for' }} "{{ searchQuery }}"</p>
        </div>
      </div>

      <!-- Backdrop -->
      <div class="search-backdrop" *ngIf="showSearchDropdown" (click)="showSearchDropdown = false"></div>
    </div>

    <!-- Desktop Icons + Language Switch -->
    <div class="nav-icons desktop-icons">
      <select [value]="currentLang" (change)="switchLang($event)" class="lang-select">
        <option value="ar">العربية</option>
        <option value="en">English</option>
      </select>

      <select class="lang-select" (change)="goTo($event)" *ngIf="isAdmin">
        <option value="all">
          {{ currentLang === 'ar' ? 'صفحات الأدمن' : 'Admin Pages' }}
        </option>
        <option value="/brands">{{'brands' | translate}}</option>
        <option value="/products">{{'manageProducts' | translate}}</option>
        <option value="/products/reviews">{{'reviews' | translate}}</option>
        <option value="/admin">{{'adminPage' | translate}}</option>
        <option value="/categories">{{'manageCategories' | translate}}</option>
      </select>

      <button *ngIf="isVendor" routerLink="/vendor" class="
    px-6 py-2.5 rounded-xl cursor-pointer
    bg-gradient-to-r from-blue-500/90 to-purple-500/90
    backdrop-blur-sm
    text-white font-medium
    border border-white/20
    shadow-md hover:shadow-lg
    hover:scale-[1.03]
    transition-all duration-300
  ">
        {{ 'dashboard' | translate }}
      </button>


      <button class="icon-btn" title="Wishlist" routerLink="products/wishlist">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path
            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
          </path>
        </svg>
      </button>
      <button class="icon-btn cart-btn" title="Cart" routerLink="/cart">
        <div class="cart-icon-wrapper">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
          <span *ngIf="cartCount > 0" class="cart-badge-desktop">{{ cartCount }}</span>
        </div>
      </button>
    </div>
  </div>
</header>

<!-- ═══════════════════════════════════════════════ -->
<!-- MOBILE BOTTOM NAV BAR -->
<!-- ═══════════════════════════════════════════════ -->
<nav class="mobile-bottom-nav">
  <!-- Home -->
  <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="bottom-nav-item">
    <i class="fa-solid fa-house"></i>
    <span>{{ 'home' | translate }}</span>
  </a>

  <!-- Categories -->
  <button (click)="toggleCategoriesMenu()" class="bottom-nav-item" [class.active]="isCategoriesMenuOpen">
    <i class="fa-solid fa-list"></i>
    <span>{{ 'categories' | translate }}</span>
  </button>

  <!-- Vendor Dashboard (Only for Vendors) -->
  <a *ngIf="isVendor" routerLink="/vendor" routerLinkActive="active" class="bottom-nav-item vendor-item">
    <i class="fa-solid fa-store"></i>
    <span>{{ currentLang === 'ar' ? 'متجري' : 'My Store' }}</span>
  </a>

  <!-- Admin Pages (Only for Admins) -->
  <button *ngIf="isAdmin" (click)="toggleAdminMenu()" class="bottom-nav-item" [class.active]="isAdminMenuOpen">
    <i class="fa-solid fa-shield-halved"></i>
    <span>{{ currentLang === 'ar' ? 'الأدمن' : 'Admin' }}</span>
  </button>

  <!-- Cart -->
  <a routerLink="/cart" routerLinkActive="active" class="bottom-nav-item">
    <div class="relative">
      <i class="fa-solid fa-cart-shopping"></i>
      <span *ngIf="cartCount > 0" class="cart-badge">{{ cartCount }}</span>
    </div>
    <span>{{ 'cart' | translate }}</span>
  </a>

  <!-- Wishlist (Hide if Vendor to save space) -->
  <a *ngIf="!isVendor" routerLink="products/wishlist" routerLinkActive="active" class="bottom-nav-item">
    <i class="fa-solid fa-heart"></i>
    <span>{{ 'fav' | translate }}</span>
  </a>

  <!-- Profile / Login -->
  <button *ngIf="isLogged" routerLink="/auth/profile" class="bottom-nav-item" [class.active]="isProfileMenuOpen">
    <i class="fa-solid fa-user"></i>
    <span>{{ 'profile' | translate }}</span>
  </button>
  <a *ngIf="!isLogged" routerLink="/auth/login" routerLinkActive="active" class="bottom-nav-item">
    <i class="fa-solid fa-right-to-bracket"></i>
    <span>{{ 'login' | translate }}</span>
  </a>
</nav>

<!-- ═══════════════════════════════════════════════ -->
<!-- CATEGORIES MENU POPUP -->
<!-- ═══════════════════════════════════════════════ -->
<div class="categories-menu-overlay" [class.open]="isCategoriesMenuOpen" (click)="toggleCategoriesMenu()">
  <div class="categories-menu" (click)="$event.stopPropagation()">
    <div class="categories-menu-header">
      <h3>{{ 'categories' | translate }}</h3>
      <button (click)="toggleCategoriesMenu()" class="close-btn">&times;</button>
    </div>
    <div class="categories-menu-list">
      <a *ngFor="let cat of categories" routerLink="products" (click)="toggleCategoriesMenu(); $event.preventDefault()"
        class="category-menu-item">
        <span>{{ i18n.currentLang === 'ar' ? cat.nameAr : cat.nameEn }}</span>
        <svg *ngIf="cat.hasChildren" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!-- ADMIN MENU POPUP -->
<!-- ═══════════════════════════════════════════════ -->
<div class="admin-menu-overlay" [class.open]="isAdminMenuOpen" (click)="toggleAdminMenu()">
  <div class="admin-menu" (click)="$event.stopPropagation()">
    <div class="admin-menu-header">
      <h3>{{ currentLang === 'ar' ? 'صفحات الأدمن' : 'Admin Pages' }}</h3>
      <button (click)="toggleAdminMenu()" class="close-btn">&times;</button>
    </div>
    <div class="admin-menu-list">
      <button *ngFor="let page of adminPages" (click)="navigateToAdminPage(page.route)" class="admin-menu-item">
        <div class="admin-item-content">
          <i class="fa-solid" [class]="page.icon"></i>
          <span>{{ i18n.currentLang === 'ar' ? page.nameAr : page.nameEn }}</span>
        </div>
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!-- Vendor MENU POPUP -->
<!-- ═══════════════════════════════════════════════ -->
<div class="admin-menu-overlay" [class.open]="isVendorMenuOpen" (click)="toggleVendorMenu()">
  <div class="admin-menu" (click)="$event.stopPropagation()">
    <div class="admin-menu-header">
      <h3>{{ currentLang === 'ar' ? 'صفحات التاجر' : 'Vendor Pages' }}</h3>
      <button (click)="toggleVendorMenu()" class="close-btn">&times;</button>
    </div>
    <div class="admin-menu-list">
      <button *ngFor="let page of vendorPages" (click)="navigateToAdminPage(page.route)" class="admin-menu-item">
        <div class="admin-item-content">
          <i class="fa-solid" [class]="page.icon"></i>
          <span>{{ i18n.currentLang === 'ar' ? page.nameAr : page.nameEn }}</span>
        </div>
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!-- PROFILE MENU POPUP -->
<!-- ═══════════════════════════════════════════════ -->
<div class="profile-menu-overlay" [class.open]="isProfileMenuOpen" (click)="toggleProfileMenu()">
  <div class="profile-menu" (click)="$event.stopPropagation()">
    <a routerLink="/profile" (click)="toggleProfileMenu()" class="profile-menu-item">
      <i class="fa-solid fa-user-circle"></i>
      <span>{{ 'profile' | translate }}</span>
    </a>
    <button (click)="logout(); toggleProfileMenu()" class="profile-menu-item logout">
      <i class="fa-solid fa-right-from-bracket"></i>
      <span>{{ 'logout' | translate }}</span>
    </button>
  </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!-- FIXED ACTION BUTTON -->
<!-- ═══════════════════════════════════════════════ -->
<div class="fixed-action-button">
  <button (click)="toggleActionMenu()" class="main-action-btn">
    <i class="fa-solid fa-ellipsis-vertical"></i>
  </button>

  <div class="action-menu-popup" [class.open]="isActionMenuOpen">
    <button (click)="toggleLang(); toggleActionMenu()" class="action-menu-item">
      <i class="fa-solid fa-language"></i>
      <span>{{ currentLang === 'ar' ? 'تغيير اللغة' : 'Change Language' }}</span>
    </button>
    <button (click)="toggleActionMenu()" class="action-menu-item">
      <i class="fa-solid fa-headset"></i>
      <span>{{ currentLang === 'ar' ? 'خدمة العملاء' : 'Customer Support' }}</span>
    </button>
  </div>
</div>