<!-- navbar.component.html -->

<header class="navbar">
  <div class="navbar-container">

    <!-- Logo -->
    <div class="logo cursor-pointer" routerLink="">
      <img src="noqta logo rm.png" alt="MarketPlace Logo"
        class="logo-image h-20 sm:h-23 lg:h-23 w-auto object-contain" />
    </div>

    <!-- Desktop Nav Links -->
    <nav class="nav-links desktop-nav">
      <a *ngFor="let link of navLinks" [routerLink]="link.url" (click)="handleNavClick(link)"
        class="nav-link cursor-pointer">
        {{ link.label | translate }}
      </a>
    </nav>

    <!-- Desktop Search Bar -->
    <div class="search-bar desktop-search">
      <input type="text" [placeholder]="i18n.t('search_placeholder')" [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()" />
      <button class="search-btn" (click)="onSearch()">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5"
          stroke-linecap="round">
          <circle cx="11" cy="11" r="7"></circle>
          <line x1="16.5" y1="16.5" x2="22" y2="22"></line>
        </svg>
      </button>
    </div>

    <!-- Desktop Icons + Language Switch -->
    <div class="nav-icons desktop-icons">
      <select [value]="currentLang" (change)="switchLang($event)" class="lang-select">
        <option value="ar">العربية</option>
        <option value="en">English</option>
      </select>

      <select class="lang-select" (change)="goTo($event)" *ngIf="isAdmin">
        <option value="all">
          {{ currentLang === 'ar' ? 'صفحات الأدمن' : 'Admin Pages' }}
        </option>
        <option value="/brands">{{'brands' | translate}}</option>
        <option value="/products">{{'manageProducts' | translate}}</option>
        <option value="/products/reviews">{{'reviews' | translate}}</option>
      </select>

      <button class="icon-btn" title="Wishlist" routerLink="products/wishlist">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path
            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
          </path>
        </svg>
      </button>
      <button class="icon-btn cart-btn" title="Cart" routerLink="/cart">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- ═══════════════════════════════════════════════ -->
<!-- MOBILE BOTTOM NAV BAR -->
<!-- ═══════════════════════════════════════════════ -->
<nav class="mobile-bottom-nav">
  <!-- Home -->
  <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="bottom-nav-item">
    <i class="fa-solid fa-house"></i>
    <span>{{ 'home' | translate }}</span>
  </a>

  <!-- Categories -->
  <button (click)="toggleCategoriesMenu()" class="bottom-nav-item" [class.active]="isCategoriesMenuOpen">
    <i class="fa-solid fa-list"></i>
    <span>{{ 'categories' | translate }}</span>
  </button>

  <!-- Admin Pages (Only for Admins) -->
  <button *ngIf="isAdmin" (click)="toggleAdminMenu()" class="bottom-nav-item" [class.active]="isAdminMenuOpen">
    <i class="fa-solid fa-shield-halved"></i>
    <span>{{ currentLang === 'ar' ? 'الأدمن' : 'Admin' }}</span>
  </button>

  <!-- Cart -->
  <a routerLink="/cart" routerLinkActive="active" class="bottom-nav-item">
    <div class="relative">
      <i class="fa-solid fa-cart-shopping"></i>
      <span *ngIf="cartCount > 0" class="cart-badge">{{ cartCount }}</span>
    </div>
    <span>{{ 'cart' | translate }}</span>
  </a>

  <!-- Wishlist -->
  <a routerLink="products/wishlist" routerLinkActive="active" class="bottom-nav-item">
    <i class="fa-solid fa-heart"></i>
    <span>{{ 'fav' | translate }}</span>
  </a>

  <!-- Profile / Login -->
  <!-- <button *ngIf="isLogged" (click)="toggleProfileMenu()" class="bottom-nav-item" [class.active]="isProfileMenuOpen"> -->
  <button *ngIf="isLogged" routerLink="/auth/profile" class="bottom-nav-item" [class.active]="isProfileMenuOpen">
    <i class="fa-solid fa-user"></i>
    <span>{{ 'profile' | translate }}</span>
  </button>
  <a *ngIf="!isLogged" routerLink="/auth/login" routerLinkActive="active" class="bottom-nav-item">
    <i class="fa-solid fa-right-to-bracket"></i>
    <span>{{ 'login' | translate }}</span>
  </a>
</nav>

<!-- ═══════════════════════════════════════════════ -->
<!-- CATEGORIES MENU POPUP -->
<!-- ═══════════════════════════════════════════════ -->
<div class="categories-menu-overlay" [class.open]="isCategoriesMenuOpen" (click)="toggleCategoriesMenu()">
  <div class="categories-menu" (click)="$event.stopPropagation()">
    <div class="categories-menu-header">
      <h3>{{ 'categories' | translate }}</h3>
      <button (click)="toggleCategoriesMenu()" class="close-btn">&times;</button>
    </div>
    <div class="categories-menu-list">
      <a *ngFor="let cat of categories" routerLink="products" (click)="toggleCategoriesMenu(); $event.preventDefault()"
        class="category-menu-item">
        <span>{{ i18n.currentLang === 'ar' ? cat.nameAr : cat.nameEn }}</span>
        <svg *ngIf="cat.hasChildren" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!-- ADMIN MENU POPUP -->
<!-- ═══════════════════════════════════════════════ -->
<div class="admin-menu-overlay" [class.open]="isAdminMenuOpen" (click)="toggleAdminMenu()">
  <div class="admin-menu" (click)="$event.stopPropagation()">
    <div class="admin-menu-header">
      <h3>{{ currentLang === 'ar' ? 'صفحات الأدمن' : 'Admin Pages' }}</h3>
      <button (click)="toggleAdminMenu()" class="close-btn">&times;</button>
    </div>
    <div class="admin-menu-list">
      <button *ngFor="let page of adminPages" (click)="navigateToAdminPage(page.route)" class="admin-menu-item">
        <div class="admin-item-content">
          <i class="fa-solid" [class]="page.icon"></i>
          <span>{{ i18n.currentLang === 'ar' ? page.nameAr : page.nameEn }}</span>
        </div>
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!-- PROFILE MENU POPUP -->
<!-- ═══════════════════════════════════════════════ -->
<div class="profile-menu-overlay" [class.open]="isProfileMenuOpen" (click)="toggleProfileMenu()">
  <div class="profile-menu" (click)="$event.stopPropagation()">
    <a routerLink="/profile" (click)="toggleProfileMenu()" class="profile-menu-item">
      <i class="fa-solid fa-user-circle"></i>
      <span>{{ 'profile' | translate }}</span>
    </a>
    <button (click)="logout(); toggleProfileMenu()" class="profile-menu-item logout">
      <i class="fa-solid fa-right-from-bracket"></i>
      <span>{{ 'logout' | translate }}</span>
    </button>
  </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!-- FIXED ACTION BUTTON -->
<!-- ═══════════════════════════════════════════════ -->
<div class="fixed-action-button">
  <button (click)="toggleActionMenu()" class="main-action-btn">
    <i class="fa-solid fa-ellipsis-vertical"></i>
  </button>

  <div class="action-menu-popup" [class.open]="isActionMenuOpen">
    <button (click)="toggleLang(); toggleActionMenu()" class="action-menu-item">
      <i class="fa-solid fa-language"></i>
      <span>{{ currentLang === 'ar' ? 'تغيير اللغة' : 'Change Language' }}</span>
    </button>
    <button (click)="toggleActionMenu()" class="action-menu-item">
      <i class="fa-solid fa-headset"></i>
      <span>{{ currentLang === 'ar' ? 'خدمة العملاء' : 'Customer Support' }}</span>
    </button>
  </div>
</div>